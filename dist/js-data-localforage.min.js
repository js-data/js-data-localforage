/**
* @author Jason Dobry <jason.dobry@gmail.com>
* @file js-data-localforage.min.js
* @version 1.0.0 - Homepage <http://wwwjs-data.io/js-data-localforage>
* @copyright (c) 2014 Jason Dobry
* @license MIT <https://github.com/js-data/js-data-localforage/blob/master/LICENSE>
*
* @overview localforage adapter for js-data.
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.DSLocalForageAdapter=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c=a("./isKind"),d=Array.isArray||function(a){return c(a,"Array")};b.exports=d},{"./isKind":2}],2:[function(a,b){function c(a,b){return d(a)===b}var d=a("./kindOf");b.exports=c},{"./kindOf":3}],3:[function(a,b){function c(a){return null===a?"Null":a===d?"Undefined":e.exec(f.call(a))[1]}var d,e=/^\[object (.*)\]$/,f=Object.prototype.toString;b.exports=c},{}],4:[function(a,b){b.exports=2147483647},{}],5:[function(a,b){b.exports=-2147483648},{}],6:[function(a,b){function c(){g=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],f=!0;for(var a in{toString:null})f=!1}function d(a,b,d){var i,j=0;null==f&&c();for(i in a)if(e(b,a,i,d)===!1)break;if(f)for(var k=a.constructor,l=!!k&&a===k.prototype;(i=g[j++])&&("constructor"===i&&(l||!h(a,i))||a[i]===Object.prototype[i]||e(b,a,i,d)!==!1););}function e(a,b,c,d){return a.call(d,b[c],c,b)}var f,g,h=a("./hasOwn");b.exports=d},{"./hasOwn":8}],7:[function(a,b){function c(a,b,c){e(a,function(e,f){return d(a,f)?b.call(c,a[f],f,a):void 0})}var d=a("./hasOwn"),e=a("./forIn");b.exports=c},{"./forIn":6,"./hasOwn":8}],8:[function(a,b){function c(a,b){return Object.prototype.hasOwnProperty.call(a,b)}b.exports=c},{}],9:[function(a,b){var c=a("./forOwn"),d=Object.keys||function(a){var b=[];return c(a,function(a,c){b.push(c)}),b};b.exports=d},{"./forOwn":7}],10:[function(a,b){function c(a){var b=1===arguments.length&&e(a)?a:arguments;return b[d(0,b.length-1)]}var d=a("./randInt"),e=a("../lang/isArray");b.exports=c},{"../lang/isArray":1,"./randInt":14}],11:[function(a,b){function c(){return d(8)+"-"+d(4)+"-4"+d(3)+"-"+e(8,9,"a","b")+d(3)+"-"+d(12)}var d=a("./randHex"),e=a("./choice");b.exports=c},{"./choice":10,"./randHex":13}],12:[function(a,b){function c(a,b){return a=null==a?e:a,b=null==b?f:b,a+(b-a)*d()}var d=a("./random"),e=a("../number/MIN_INT"),f=a("../number/MAX_INT");b.exports=c},{"../number/MAX_INT":4,"../number/MIN_INT":5,"./random":15}],13:[function(a,b){function c(a){a=a&&a>0?a:6;for(var b="";a--;)b+=d(e);return b}var d=a("./choice"),e="0123456789abcdef".split("");b.exports=c},{"./choice":10}],14:[function(a,b){function c(a,b){return a=null==a?d:~~a,b=null==b?e:~~b,Math.round(f(a-.5,b+.499999999999))}var d=a("../number/MIN_INT"),e=a("../number/MAX_INT"),f=a("./rand");b.exports=c},{"../number/MAX_INT":4,"../number/MIN_INT":5,"./rand":12}],15:[function(a,b){function c(){return c.get()}c.get=Math.random,b.exports=c},{}],16:[function(a,b){function c(){}function d(a){a=a||{},this.defaults=new c,j(this.defaults,a)}var e;try{e=a("js-data")}catch(f){}if(!e)try{e=window.JSData}catch(f){}if(!e)throw new Error("js-data must be loaded!");if(!localforage)throw new Error("localforage must be loaded!");var g=new e.DS,h=e.DSUtils,i=h.makePath,j=h.deepMixIn,k=h.forEach,l=g.defaults.defaultFilter,m=a("mout/random/guid"),n=a("mout/object/keys"),o=h.Promise;c.prototype.basePath="";var p=d.prototype;p.getPath=function(a,b){return i(b.basePath||this.defaults.basePath||a.basePath,a.name)},p.getIdPath=function(a,b,c){return i(b.basePath||this.defaults.basePath||a.basePath,a.getEndpoint(c,b),c)},p.getIds=function(a,b){var c=this.getPath(a,b);return new o(function(a,b){localforage.getItem(c,function(d,e){return d?b(d):e?a(e):localforage.setItem(c,{},function(c,d){c?b(c):a(d)})})})},p.saveKeys=function(a,b,c){var d=this.getPath(b,c);return new o(function(b,c){localforage.setItem(d,a,function(a,d){a?c(a):b(d)})})},p.ensureId=function(a,b,c){var d=this;return d.getIds(b,c).then(function(e){return e[a]=1,d.saveKeys(e,b,c)})},p.removeId=function(a,b,c){var d=this;return d.getIds(b,c).then(function(e){return delete e[a],d.saveKeys(e,b,c)})},p.GET=function(a){return new o(function(b,c){localforage.getItem(a,function(a,d){a?c(a):b(d)})})},p.PUT=function(a,b){return this.GET(a).then(function(c){return c&&j(c,b),new o(function(d,e){localforage.setItem(a,c||b,function(a,b){a?e(a):d(b)})})})},p.DEL=function(a){return new o(function(b){localforage.removeItem(a,b)})},p.find=function(a,b,c){return c=c||{},this.GET(this.getIdPath(a,c,b)).then(function(a){return a?a:o.reject(new Error("Not Found!"))})},p.findAll=function(a,b,c){var d=this;return c=c||{},d.getIds(a,c).then(function(b){var e=n(b);"allowSimpleWhere"in c||(c.allowSimpleWhere=!0);var f=[];return k(e,function(b){f.push(d.GET(d.getIdPath(a,c,b)))}),o.all(f)}).then(function(d){return l.call(g,d,a.name,b,c)})},p.create=function(a,b,c){var d,e=this;return b[a.idAttribute]=b[a.idAttribute]||m(),c=c||{},e.PUT(i(this.getIdPath(a,c,b[a.idAttribute])),b).then(function(b){return d=b,e.ensureId(b[a.idAttribute],a,c)}).then(function(){return d})},p.update=function(a,b,c,d){var e,f=this;return d=d||{},f.PUT(f.getIdPath(a,d,b),c).then(function(b){return e=b,f.ensureId(b[a.idAttribute],a,d)}).then(function(){return e})},p.updateAll=function(a,b,c,d){var e=this;return e.findAll(a,c,d).then(function(c){var f=[];return k(c,function(c){f.push(e.update(a,c[a.idAttribute],b,d))}),o.all(f)})},p.destroy=function(a,b,c){var d=this;return c=c||{},d.DEL(d.getIdPath(a,c,b)).then(function(){return d.removeId(b,a,c)}).then(function(){return null})},p.destroyAll=function(a,b,c){var d=this;return d.findAll(a,b,c).then(function(b){var e=[];return k(b,function(b){e.push(d.destroy(a,b[a.idAttribute],c))}),o.all(e)})},b.exports=d},{"js-data":"js-data","mout/object/keys":9,"mout/random/guid":11}]},{},[16])(16)});