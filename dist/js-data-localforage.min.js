/*!
* js-data-localforage
* @version 1.1.0 - Homepage <http://wwwjs-data.io/docs/dslocalforageadapter>
* @author Jason Dobry <jason.dobry@gmail.com>
* @copyright (c) 2014-2015 Jason Dobry
* @license MIT <https://github.com/js-data/js-data-localforage/blob/master/LICENSE>
*
* @overview localforage adapter for js-data.
*/

!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("js-data"),require("localforage")):"function"==typeof define&&define.amd?define(["js-data","localforage"],b):"object"==typeof exports?exports.DSLocalForageAdapter=b(require("js-data"),require("localforage")):a.DSLocalForageAdapter=b(a.JSData,a.localforage)}(this,function(a,b){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){var d=function(a){return a&&a.__esModule?a["default"]:a},e=function(){function a(a,b){for(var c in b){var d=b[c];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(a,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},g=d(c(1)),h=d(c(2)),i=new g.DS,j=g.DSUtils,k=j.makePath,l=j.deepMixIn,m=j.forEach,n=i.defaults.defaultFilter,o=j.removeCircular,p=c(3),q=c(5),r=c(4),s=j.Promise,t=function v(){f(this,v)};t.prototype.basePath="";var u=function(){function a(b){f(this,a),this.defaults=new t,l(this.defaults,b)}return e(a,{getPath:{value:function(a,b){return k(b.basePath||this.defaults.basePath||a.basePath,a.name)}},getIdPath:{value:function(a,b,c){return k(b.basePath||this.defaults.basePath||a.basePath,a.getEndpoint(c,b),c)}},getIds:{value:function(a,b){var c=this.getPath(a,b);return new s(function(a,b){h.getItem(c,function(d,e){return d?b(d):e?a(e):h.setItem(c,{},function(c,d){c?b(c):a(d)})})})}},saveKeys:{value:function(a,b,c){var d=this.getPath(b,c);return new s(function(b,c){h.setItem(d,a,function(a,d){a?c(a):b(d)})})}},ensureId:{value:function(a,b,c){var d=this;return this.getIds(b,c).then(function(e){return e[a]=1,d.saveKeys(e,b,c)})}},removeId:{value:function(a,b,c){var d=this;return this.getIds(b,c).then(function(e){return delete e[a],d.saveKeys(e,b,c)})}},GET:{value:function(a){return new s(function(b,c){h.getItem(a,function(a,d){a?c(a):b(d)})})}},PUT:{value:function(a,b){return b=o(b),this.GET(a).then(function(c){return c&&l(c,b),new s(function(d,e){h.setItem(a,c||b,function(a,b){return a?e(a):d(b)})})})}},DEL:{value:function(a){return new s(function(b){return h.removeItem(a,b)})}},find:{value:function(a,b,c){return c=c||{},this.GET(this.getIdPath(a,c,b)).then(function(a){return a?a:s.reject(new Error("Not Found!"))})}},findAll:{value:function(a,b,c){var d=this;return c=c||{},this.getIds(a,c).then(function(b){var e=r(b);"allowSimpleWhere"in c||(c.allowSimpleWhere=!0);var f=[];return m(e,function(b){f.push(d.GET(d.getIdPath(a,c,b)))}),s.all(f)}).then(function(d){return n.call(i,d,a.name,b,c)})}},create:{value:function(a,b,c){var d=this,e=void 0;return b[a.idAttribute]=b[a.idAttribute]||q(),c=c||{},this.PUT(k(this.getIdPath(a,c,b[a.idAttribute])),p(b,a.relationFields||[])).then(function(b){return e=b,d.ensureId(b[a.idAttribute],a,c)}).then(function(){return e})}},update:{value:function(a,b,c,d){var e=this,f=void 0;return d=d||{},this.PUT(this.getIdPath(a,d,b),p(c,a.relationFields||[])).then(function(b){return f=b,e.ensureId(b[a.idAttribute],a,d)}).then(function(){return f})}},updateAll:{value:function(a,b,c,d){var e=this;return this.findAll(a,c,d).then(function(c){var f=[];return m(c,function(c){f.push(e.update(a,c[a.idAttribute],p(b,a.relationFields||[]),d))}),s.all(f)})}},destroy:{value:function(a,b,c){var d=this;return c=c||{},this.DEL(this.getIdPath(a,c,b)).then(function(){return d.removeId(b,a,c)}).then(function(){return null})}},destroyAll:{value:function(a,b,c){var d=this;return this.findAll(a,b,c).then(function(b){var e=[];return m(b,function(b){e.push(d.destroy(a,b[a.idAttribute],c))}),s.all(e)})}}}),a}();a.exports=u},function(b){b.exports=a},function(a){a.exports=b},function(a,b,c){function d(a){var b="string"!=typeof arguments[1]?arguments[1]:e(arguments,1),c={};for(var d in a)a.hasOwnProperty(d)&&!f(b,d)&&(c[d]=a[d]);return c}var e=c(6),f=c(7);a.exports=d},function(a,b,c){var d=c(8),e=Object.keys||function(a){var b=[];return d(a,function(a,c){b.push(c)}),b};a.exports=e},function(a,b,c){function d(){return e(8)+"-"+e(4)+"-4"+e(3)+"-"+f(8,9,"a","b")+e(3)+"-"+e(12)}var e=c(9),f=c(10);a.exports=d},function(a){function b(a,b,c){var d=a.length;b=null==b?0:0>b?Math.max(d+b,0):Math.min(b,d),c=null==c?d:0>c?Math.max(d+c,0):Math.min(c,d);for(var e=[];c>b;)e.push(a[b++]);return e}a.exports=b},function(a,b,c){function d(a,b){return-1!==e(a,b)}var e=c(11);a.exports=d},function(a,b,c){function d(a,b,c){f(a,function(d,f){return e(a,f)?b.call(c,a[f],f,a):void 0})}var e=c(12),f=c(13);a.exports=d},function(a,b,c){function d(a){a=a&&a>0?a:6;for(var b="";a--;)b+=e(f);return b}var e=c(10),f="0123456789abcdef".split("");a.exports=d},function(a,b,c){function d(a){var b=1===arguments.length&&f(a)?a:arguments;return b[e(0,b.length-1)]}var e=c(14),f=c(15);a.exports=d},function(a){function b(a,b,c){if(c=c||0,null==a)return-1;for(var d=a.length,e=0>c?d+c:c;d>e;){if(a[e]===b)return e;e++}return-1}a.exports=b},function(a){function b(a,b){return Object.prototype.hasOwnProperty.call(a,b)}a.exports=b},function(a,b,c){function d(){h=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],g=!0;for(var a in{toString:null})g=!1}function e(a,b,c){var e,j=0;null==g&&d();for(e in a)if(f(b,a,e,c)===!1)break;if(g)for(var k=a.constructor,l=!!k&&a===k.prototype;(e=h[j++])&&("constructor"===e&&(l||!i(a,e))||a[e]===Object.prototype[e]||f(b,a,e,c)!==!1););}function f(a,b,c,d){return a.call(d,b[c],c,b)}var g,h,i=c(12);a.exports=e},function(a,b,c){function d(a,b){return a=null==a?e:~~a,b=null==b?f:~~b,Math.round(g(a-.5,b+.499999999999))}var e=c(16),f=c(17),g=c(18);a.exports=d},function(a,b,c){var d=c(19),e=Array.isArray||function(a){return d(a,"Array")};a.exports=e},function(a){a.exports=-2147483648},function(a){a.exports=2147483647},function(a,b,c){function d(a,b){return a=null==a?f:a,b=null==b?g:b,a+(b-a)*e()}var e=c(20),f=c(16),g=c(17);a.exports=d},function(a,b,c){function d(a,b){return e(a)===b}var e=c(21);a.exports=d},function(a){function b(){return b.get()}b.get=Math.random,a.exports=b},function(a){function b(a){return null===a?"Null":a===c?"Undefined":d.exec(e.call(a))[1]}var c,d=/^\[object (.*)\]$/,e=Object.prototype.toString;a.exports=b}])});
//# sourceMappingURL=js-data-localforage.min.map